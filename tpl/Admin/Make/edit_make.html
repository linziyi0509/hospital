<!-- $Id: goods_info.htm 17126 2010-04-23 10:30:26Z liuhui $ -->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"><head>

<title>预约系统 - 修改预约 </title>

<meta name="robots" content="noindex, nofollow">

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<link href="__ADMIN_ACEADMIN__/css/general.css" rel="stylesheet" type="text/css">

<link href="__ADMIN_ACEADMIN__/css/main.css" rel="stylesheet" type="text/css">

<script src="__ADMIN_ACEADMIN__/js/jquery-1.8.3.min.js"></script>

<script type="text/javascript" src="__ADMIN_ACEADMIN__/js/datepicker.js"></script> 

<script language="javascript" type="text/javascript" src="__ADMIN_ACEADMIN__/js/My97DatePicker/WdatePicker.js"></script>
<script type="text/javascript" src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>
</head>

<body>



<h1>

<span class="action-span"><a href="{:U('Admin/Make/index')}">预约列表</a></span>

<span class="action-span1"><a href="{:U('Admin/Index/index')}">预约系统</a> </span><span id="search_id" class="action-span1"> - 修改预约 </span>

<div style="clear:both"></div>

</h1>





<!-- start goods form -->

<div class="tab-div">

    <!-- tab bar -->

    <div id="tabbar-div">

      <p>

        <span class="tab-front" id="general-tab">修改患者信息</span>

      </p>

    </div>



    <!-- tab body -->

    <div id="tabbody-div">

      <form enctype="multipart/form-data" action="{:U('Admin/Make/edit_make')}" method="post" onSubmit="return checkbaoming();" name="theForm">

<?php foreach ($make as $key => $va): ?> <?php endforeach ?>  

        <table id="general-table" width="90%" align="center">

          <tbody><tr>

            <td class="label">患者姓名：</td>

            <td><input name="name" id="name" style="float:left;color:;" size="30" type="text" value="<?php echo $make['name']; ?>">

            <span class="require-field">*</span></td>

          </tr>

      <tr>

            <td class="label">患者别名：</td>

            <td><input name="alias" style="float:left;color:;" size="30" type="text"  value="<?php echo $make['alias']; ?>"></td>

          </tr>

      <tr>

            <td class="label">患者电话：</td>

            <td><input name="phone" id="phone" style="float:left;color:;" size="30" type="text" value="<?php echo $make['phone']; ?>"><span class="require-field">*</span></td>

          </tr>

      <tr>

            <td class="label">患者电话2：</td>

            <td><input name="phones" style="float:left;color:;" size="30" type="text" value="<?php echo $make['phones']; ?>"></td>

          </tr>

          <tr>

            <td class="label">性别：</td>

            <td>

        <input class="radio" id="radio" type="radio" name="sex" value="男" <?php if($make['sex']=='男') echo("checked");?>/> 男 

        <input class="radio" id="radio" type="radio" name="sex" value="女" <?php if($make['sex']=='女') echo("checked");?>/> 女

        <input class="radio" id="radio" type="radio" name="sex" value="不详" <?php if($make['sex']=='不详') echo("checked");?>/>不详

        <span class="require-field">*</span>

      </td>

          </tr>

                   <tr>

            <td class="label">初/复诊：</td>

            <td>

        <input class="radio2" type="radio" name="again" value="0" <?php if($make['again']=='0') echo("checked");?>/> 初诊

        <input class="radio2" type="radio" name="again" value="1" <?php if($make['again']=='1') echo("checked");?>/> 复诊

        <span class="require-field">*</span>

      </td>

          </tr>

      <tr>

            <td class="label">年龄：</td>

            <td><input name="age" id="age" style="float:left;color:;" size="30" type="text" value="<?php echo $make['age']; ?>"></td>

          </tr>

                <tr>
            <td class="label">家庭住址：</td>
            <td>
              <select name="address" id="address">
              <option value="">请选择...</option>
              <foreach name="address" item="address">
              <option value="{$address['area_name']}" >{$address['area_name']}</option>
              </foreach>
              </select>

              <select name="city" id="city" style="display:none;">
              <option value="">请选择...</option>
              <foreach name="rcity" item="rcity">
              <option value="{$rcity['area_name']}" >{$rcity['area_name']}</option>
              </foreach>
              </select>
              <input type="hidden" value="" id="rcity">

              <select name="zone" id="zone" style="display:none;">
              <option value="">请选择...</option>
              <foreach name="rzone" item="rzone">
              <option value="{$rzone['area_name']}" >{$rzone['area_name']}</option>
              </foreach>
              </select>
              <input type="hidden" value="" id="rzone">
            </td>
          </tr>

  

          <tr>

            <td class="label">预约时间：</td>

            <td>

              <input type="text" id="yuyuetime" name="yuyuetime" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})" class="Wdate" style="width:200px" value="<?php echo date('Y-m-d H:i:s',$make['yuyuetime']); ?>"/>

          <span class="require-field">*</span>   

        </td>


      </td>

          </tr>

      <tr>

            <td class="label">预约专家：</td>

            <td>

        <select name="yuyuezj" id="yuyuezj">

          <option value="">请选择...</option>

          <foreach name="expert" item="zj">

          <option value="{$zj['zjname']}" >{$zj['zjname']}</option>

          </foreach>

        </select>

        <span class="require-field">*</span>            

      </td>

          </tr>

      <tr>

            <td class="label">预约科室：</td>

            <td>

        <select name="yuyueks" id="yuyueks">

          <option value="">请选择...</option>

          <foreach name="govern" item="ks">

          <option value="{$ks['ksname']}">{$ks['ksname']}</option>

          </foreach>

        </select>

      </td>

          </tr>

      <tr>

            <td class="label">预约病种：</td>

            <td>

        <select name="yuyuebz" id="yuyuebz">

          <option value="">请选择...</option>

          <foreach name="entity" item="e">

            <option value="{$e['bzname']}">{$e['bzname']}</option>

          </foreach>

        </select>

      </td>

        </tr>

        <tr>
            <td class="label">渠道来源：</td>
            <td>
        <select name="channel" id="channel">
          <option value="">请选择...</option>
          <foreach name="channel" item="c">
            <option value="{$c['name']}">{$c['name']}</option>
          </foreach>
        </select>         
      </td>
          </tr>
      <tr>

            <td class="label">预约方式：</td>
            <td>
        <select name="source" id="sources">
        <option value="">请选择...</option>
          <foreach name="source" item="s">
            <option value="{$s['name']}">{$s['name']}</option>
          </foreach>
        </select>
      </td>
          </tr>
<input id="addre" type="text" />
<script>  

  $("#yuyuezj").val("<?php echo $make['yuyuezj']; ?>"); 

    $("#yuyueks").val("<?php echo $make['yuyueks']; ?>"); 

      $("#yuyuebz").val("<?php echo $make['yuyuebz']; ?>"); 

        $("#channel").val("<?php echo $make['channel']; ?>"); 

          $("#sources").val("<?php echo $make['source']; ?>"); 
              $("#address").val("<?php echo $make['province']; ?>"); 
    $("#city").val("<?php echo $make['city']; ?>"); 
    $("#rcity").val("<?php echo $make['city']; ?>"); 
    $("#zone").val("<?php echo $make['zone']; ?>"); 
    $("#rzone").val("<?php echo $make['zone']; ?>");


</script> 

      <tr>

            <td class="label">

            <a href="javascript:showNotice('noticeSellerNote');" title="点击此处查看提示信息"><img src="__ADMIN_ACEADMIN__/avatars/notice.gif" alt="点击此处查看提示信息" width="16" height="16" border="0"></a> 患者备注： </td>

            <td><textarea name="remark" cols="40" rows="3" ><?php echo $make['remark']; ?></textarea><br>

            <span class="notice-span" style="display:block" id="noticeSellerNote">是否有意向住院或病人亲诊或家人代诊等信息备注</span></td>

          </tr>

      <tr>

            <td class="label">

            <a href="javascript:showNotice('noticeSellerNote');" title="点击此处查看提示信息"><img src="__ADMIN_ACEADMIN__/avatars/notice.gif" alt="点击此处查看提示信息" width="16" height="16" border="0"></a> 病情描述： </td>

            <td><textarea name="dialogue" cols="40" rows="3" ><?php echo $make['dialogue']; ?></textarea><br>

            <span class="notice-span" style="display:block" id="noticeSellerNote">患者病情，交流对话</span></td>

          </tr>
          <tr>
          <td class="label"><a href="javascript:showNotice('noticeSellerNote');" title="仅支持1M以内图片上传"><img src="__ADMIN_ACEADMIN__/avatars/notice.gif" alt="仅支持1M以内图片上传" width="16" height="16" border="0"></a>血常规化验：</td>
          <td><a href="javascript:;" class='xpadd' title="增加上传框">[+]</a><input type="file" id="xp" name="xp[]"></td>
          <foreach name="xp" item="xp">
          <td><img height="120" class="pimg" width="240" src="{$xp.xp}" /></td>
          </foreach>
          </tr>
          <tr>
          <td class="label">生化化验（肝功肾功电解质）：</td>
          <td><a href="javascript:;" class='shadd' title="增加上传框">[+]</a><input type="file" id="sh" name="sh[]"></td>
          <foreach name="sh" item="sh">
          <td><img height="120" class="pimg" width="240" src="{$sh.sh}" /></td>
          </foreach>
          </tr>
          <tr>
          <td class="label">肿瘤标志物化验：</td>
          <td><a href="javascript:;" class='zladd' title="增加上传框">[+]</a><input type="file" id="zl" name="zl[]"></td>
          <foreach name="zl" item="zl">
          <td><img height="120" class="pimg" width="240" src="{$zl.zl}" /></td>
          </foreach>
          </tr>
          <tr>
          <td class="label">核磁：</td>
          <td><a href="javascript:;" class='hcadd' title="增加上传框">[+]</a><input type="file" id="hc" name="hc[]"></td>
          <foreach name="hc" item="hc">
          <td><img height="120" class="pimg" width="240" src="{$hc.hc}" /></td>
          </foreach>
          </tr>
          <tr>
          <td class="label">PET-CT：</td>
          <td><a href="javascript:;" class='ctadd' title="增加上传框">[+]</a><input type="file" id="ct" name="ct[]"></td>
          <foreach name="ct" item="ct">
          <td><img height="120" class="pimg" width="240" src="{$ct.ct}" /></td>
          </foreach>
          </tr>
          <tr>
          <td class="label">手术病理报告：</td>
          <td><a href="javascript:;" class='jcdadd' title="增加上传框">[+]</a><input type="file" id="jcd" name="jcd[]"></td>
          <foreach name="jcd" item="jcd">
          <td><img height="120" class="pimg" width="240" src="{$jcd.jcd}" /></td>
          </foreach>
          </tr>
          <tr>
          <td class="label">其他：</td>
          <td><a href="javascript:;" class='qtadd' title="增加上传框">[+]</a><input type="file" id="qt" name="qt[]"></td>
          <foreach name="qt" item="qt">
          <td><img height="120" class="pimg" width="240" src="{$qt.qt}" /></td>
          </foreach>
          </tr>
        </tbody></table>

        <div class="button-div">

          <input name="id" value="<?php echo $make['id']; ?>" type="hidden">

          <input value=" 确定 " class="button" onSubmit="return checkbaoming();" type="submit">

          <input value=" 重置 " class="button" type="reset">

        </div>

      </form>

    </div>

</div>
<div id="outerdiv" style="position:fixed;top:0;left:0;background:rgba(0,0,0,0.7);z-index:99999;width:100%;height:100%;display:none;">
    <div id="innerdiv" style="position:absolute;">
        <img id="bigimg" style="border:5px solid #fff;" src="" />
    </div>
</div>
  <script>
  $(function(){
    $('.xpadd').click(function(){
      var tr="<tr><td class='label'></td><td><a href='javascript:;' class='xpremove'>[-]</a><input type='file' id='xp' name='xp[]'></td></tr>";
      $(this).parent().parent().after(tr);
    });
    $('.ctadd').click(function(){
      var tr="<tr><td class='label'></td><td><a href='javascript:;' class='ctremove'>[-]</a><input type='file' id='ct' name='ct[]'></td></tr>";
      $(this).parent().parent().after(tr);
    });
    $('.jcdadd').click(function(){
      var tr="<tr><td class='label'></td><td><a href='javascript:;' class='jcdremove'>[-]</a><input type='file' id='jcd' name='jcd[]'></td></tr>";
      $(this).parent().parent().after(tr);
    });
    $('.shadd').click(function(){
      var tr="<tr><td class='label'></td><td><a href='javascript:;' class='shremove'>[-]</a><input type='file' id='sh' name='sh[]'></td></tr>";
      $(this).parent().parent().after(tr);
    });
    $('.zladd').click(function(){
      var tr="<tr><td class='label'></td><td><a href='javascript:;' class='zlremove'>[-]</a><input type='file' id='zl' name='zl[]'></td></tr>";
      $(this).parent().parent().after(tr);
    });
    $('.hcadd').click(function(){
      var tr="<tr><td class='label'></td><td><a href='javascript:;' class='hcremove'>[-]</a><input type='file' id='hc' name='hc[]'></td></tr>";
      $(this).parent().parent().after(tr);
    });
    $('.qtadd').click(function(){
      var tr="<tr><td class='label'></td><td><a href='javascript:;' class='qtremove'>[-]</a><input type='file' id='qt' name='qt[]'></td></tr>";
      $(this).parent().parent().after(tr);
    });
  $(document).on('click','.xpremove',function(){
    $(this).parent().parent().remove();
  });
  $(document).on('click','.ctremove',function(){
    $(this).parent().parent().remove();
  });
  $(document).on('click','.jcdremove',function(){
    $(this).parent().parent().remove();
  });
  $(document).on('click','.shremove',function(){
    $(this).parent().parent().remove();
  });
  $(document).on('click','.zldremove',function(){
    $(this).parent().parent().remove();
  });
  $(document).on('click','.hcremove',function(){
    $(this).parent().parent().remove();
  });
  $(document).on('click','.qtremove',function(){
    $(this).parent().parent().remove();
  });
   });
  </script>
<script language="javascript">

    function checkbaoming(){

        var name = $("#name").val().trim();

        var phone = $("#phone").val().trim();

        var yuyuetime = $("#yuyuetime").val().trim();

        var sex=$('input:radio[name="sex"]:checked').val();

        var zj=$("#yuyuezj").val();    

        if(name=="")

        {

                alert("未添加姓名！");

                return false;

        }

        else if(phone=="")

        {

                alert("电话号码不能为空！");

                return false;

        }

        else if(sex==null)

        {

            alert('性别未选择！');                   

            return false;

        }

        else if(yuyuetime=="")

        {

            alert('预约时间未选择！');                   

            return false;

        }

        else if(zj=="")

        {

            alert('预约专家未选择！');                   

            return false;

        }

    }

</script>
<!--点击放大图片-->
<script>
    $(function(){
        $(".pimg").click(function(){
            var _this = $(this);//将当前的pimg元素作为_this传入函数
            imgShow("#outerdiv", "#innerdiv", "#bigimg", _this);
        });
    });

    function imgShow(outerdiv, innerdiv, bigimg, _this){
        var src = _this.attr("src");//获取当前点击的pimg元素中的src属性
        $(bigimg).attr("src", src);//设置#bigimg元素的src属性
            /*获取当前点击图片的真实大小，并显示弹出层及大图*/
        $("<img/>").attr("src", src).load(function(){
            var windowW = $(window).width();//获取当前窗口宽度
            var windowH = $(window).height();//获取当前窗口高度
            var realWidth = this.width;//获取图片真实宽度
            var realHeight = this.height;//获取图片真实高度
            var imgWidth, imgHeight;
            var scale = 0.8;//缩放尺寸，当图片真实宽度和高度大于窗口宽度和高度时进行缩放

            if(realHeight>windowH*scale){
                imgHeight = windowH*scale;
                imgWidth = imgHeight/realHeight*realWidth;
                if(imgWidth>windowW*scale){
                    imgWidth = windowW*scale;//再对宽度进行缩放
                }
            } 
            else if(realWidth>windowW*scale){
                imgWidth = windowW*scale;//如大于窗口宽度，图片宽度进行缩放
                            imgHeight = imgWidth/realWidth*realHeight;//等比例缩放高度
            } 
            else {
                imgWidth = realWidth;
                imgHeight = realHeight;
            }
                    $(bigimg).css("width",imgWidth);//以最终的宽度对图片缩放
            var w = (windowW-imgWidth)/2;//计算图片与窗口左边距
            var h = (windowH-imgHeight)/2;//计算图片与窗口上边距
            $(innerdiv).css({"top":h, "left":w});//设置#innerdiv的top和left属性
            $(outerdiv).fadeIn("fast");//淡入显示#outerdiv及.pimg
        });
        $(outerdiv).click(function(){
            $(this).fadeOut("fast");
        });
    }
</script>
<!--点击放大图片-->

<script type="text/javascript">
    function isnull(val) {

        var str = val.replace(/(^\s*)|(\s*$)/g, '');//去除空格;

        if (str == '' || str == undefined || str == null) {
            // console.log('空')
            return false;
        } else {
            return true;
            // console.log('非空');
        }
    }
    var rcity = $('#rcity').val();
    var cityv = isnull(rcity);
    // alert(cityv);
    if(cityv)
    {
      // alert(1);
      $('#city').removeAttr('style');
    }
    else
    {
      // alert(123);
      $('#zone').remove();
    }
    var rzone = $('#rzone').val();
    var zonev = isnull(rzone);
    // alert(zonev);
    if(zonev)
    {
      // alert(1);
      $('#zone').removeAttr('style');
    }
  $(function(){
       $('#address').change(function(){
         $.ajax({
             type: "POST",
             url: "{:U('areaChange')}",
             data: {address:$("#address").val()},
             dataType: "json",
             success: function(data){
                $('#city').remove();
                $('#zone').remove();
                $('#address').after(data);
                }
          });
      });

      $(document).on('change','#city',function(){
         $.ajax({
             type: "POST",
             url: "{:U('areaChange')}",
             data: {city:$("#city").val()},
             dataType: "json",
             success: function(data){
                $('#zone').remove();
                $('#city').after(data);
                }
          });
      });


      // $.ajax({
      //        type: "POST",
      //        url: "{:U('sourceGet')}",
      //        data: {mode:$("#channel").val()},
      //        dataType: "json",
      //        success: function(data){

      //           // $('#sources').empty();
      //           $('#sources').prepend(data);
      //           }
      //     });
        $('#channel').change(function(){
         $.ajax({
             type: "POST",
             url: "{:U('sourceGet')}",
             data: {mode:$("#channel").val()},
             dataType: "json",
             success: function(data){

                $('#sources').empty();
                $('#sources').prepend(data);
                }
          });
      });
  });
</script>
</body>

</html>