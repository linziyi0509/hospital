<!-- $Id: goods_list.htm 17126 2010-04-23 10:30:26Z liuhui $ -->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>预约系统 - 专家转诊 </title>
<meta name="robots" content="noindex, nofollow">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="__ADMIN_ACEADMIN__/css/general.css" rel="stylesheet" type="text/css" />
<link href="__ADMIN_ACEADMIN__/css/main.css" rel="stylesheet" type="text/css" />
<!-- <link href="__ADMIN_ACEADMIN__/css/referralstyle.css" rel="stylesheet" type="text/css" /> -->
<link href="/tpl/Public/css/page.css" rel="stylesheet" type="text/css" />
<script src="__ADMIN_ACEADMIN__/js/jquery.1.7.2.min.js"></script>
<script src="__ADMIN_ACEADMIN__/js/mobiscroll_002.js" type="text/javascript"></script>
<script src="__ADMIN_ACEADMIN__/js/mobiscroll_004.js" type="text/javascript"></script>
<link href="__ADMIN_ACEADMIN__/css/mobiscroll_002.css" rel="stylesheet" type="text/css">
<link href="__ADMIN_ACEADMIN__/css/mobiscroll.css" rel="stylesheet" type="text/css">
<script src="__ADMIN_ACEADMIN__/js/mobiscroll.js" type="text/javascript"></script>
<script src="__ADMIN_ACEADMIN__/js/mobiscroll_003.js" type="text/javascript"></script>
<script src="__ADMIN_ACEADMIN__/js/mobiscroll_005.js" type="text/javascript"></script>
<link href="__ADMIN_ACEADMIN__/css/mobiscroll_003.css" rel="stylesheet" type="text/css">

  <style>
    .login{width:500px;position:fixed;border:#dddddd solid 1px;height:320px;top:50%;left:50%;display:none;background:#dddddd;box-shadow:0px 0px 20px #ddd;z-index:1;margin-left:-250px;margin-top:-140px;}
.login-title{width:100%;margin:10px 0px 0px 0px;text-align:center;line-height:40px;height:40px;font-size:18px;position:relative;}
.login-title span{position:absolute;font-size:12px;right:-20px;top:-30px;background:#ffffff;border:#ebebeb solid 1px;width:40px;height:40px;border-radius:20px;}
.login-title span a{display:block;}
.login-input-content{margin-top:20px;}
.login-input {overflow:hidden;margin:0px 0px 20px 0px;}
.login-input label{float:left;width:90px;padding-right:10px;text-align:right;line-height:35px;height:35px;font-size:14px;}
.login-input input.list-input{float:left;line-height:35px;height:35px;width:350px;border:#ebebeb 1px solid;text-indent:5px;}
.login-button{width:50%;height:50px;margin:10px auto 0px auto;line-height:40px;font-size:14px;border:#ebebeb 1px solid;text-align:center;}
.login-button a{display:block;}
.login-bg{width:100%;height:100%;position:fixed;top:0px;left:0px;background:#fff;filter:alpha(opacity=30);-moz-opacity:0.3;-khtml-opacity:0.3;opacity:0.3;display:none;}
  </style>
</head>
<body>

<!-- <h1>
<span class="action-span"><a href="{:U('Admin/Make/control_xls')}">数据导出</a></span>
<span class="action-span"><a href="{:U('Admin/Make/control_add')}">添加新预约</a></span>
<span class="action-span1"><a href="{:U('Admin/Index/welcome')}">预约系统</a> </span>
<span class="action-span1">-----<a href="{:U('Admin/Make/control_show',array('sign'=>1))}">今日预约信息列表</a> </span>
<span class="action-span1">-----<a href="{:U('Admin/Make/control_show',array('sign'=>2))}">今日添加信息列表</a> </span>
<span class="action-span1">-----<a href="{:U('Admin/Make/control_show',array('sign'=>3))}">全部信息列表</a> </span>
<div style="clear:both"></div>
</h1> -->
<!-- 预约搜索 -->
<!-- $Id: goods_search.htm 16790 2009-11-10 08:56:15Z wangleisvn $ -->
<div class="form-div">
  <form action="{:U('Admin/Make/referral_search')}" name="searchForm" method="post">
    <img src="__ADMIN_ACEADMIN__/avatars/icon_search.gif" width="26" height="22" border="0" alt="SEARCH" />
        <!-- 关键字 -->
    预约时间   <input type="text" id="yuyuetime" name="start" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})" class="Wdate" style="width:200px"/>
        <input type="text" id="yuyuetime" name="end" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})" class="Wdate" style="width:200px"/>
    姓名 <input type="text" name="name" size="15" />
    电话 <input type="text" name="phone" size="15" />
    <input type="submit" value=" 搜索 " class="button" />
  </form>
</div>

<!-- 商品列表 -->
<form method="post" action="" name="listForm" onsubmit="return confirmSubmit(this)">
  <!-- start goods list -->
  <div class="list-div" id="listDiv">
<table cellpadding="3" cellspacing="1">
  <tr>
    <th><span>序号</span></th>
	  <th><span>患者编号</span></th>
    <th><span>患者姓名</span></th>
    <th><span>电话</span></th>
    <th><span>到诊时间</span></th>
    <th><span>预约专家</span></th>
    <th><span>病种类型</span></th>
    <th><span>病情描述</span></th>
    <th><span>是否到诊</span></th>
    <th><span>到诊类型</span></th>
    <th><span>是否消费</span></th>
    <th><span>是否住院</span></th>
    <th><span>初/复诊</span></th>
    <th><span>提交时间</span></th>
    <th>操作</th>
  </tr>
    <?php foreach ($data as $key => $va): ?>
  <tr>
    <td align="center"><?php echo ++$i ?></td>
    <td align="center"><span><?php echo $va['id']; ?></span></td>
    <td align="center"><span><?php echo $va['name']; ?></span></td>
	  <td align="center" class="first-cell" style=""><span><?php echo $va['phone']; ?></span></td>
    <td align="center"><span><?php echo date('Y-m-d H:i:s',$va['yuyuetime']); ?></span></td>
	  <td align="center"> <span><?php echo $va['yuyuezj']; ?></span></td>
    <td align="center"><span><?php echo $va['yuyuebz']; ?></span></td>
    <td align="center"><span><?php echo $va['dialogue']; ?></span></td>
    <td align="center"><a href="#" title="是否到诊"><img src="__ADMIN_ACEADMIN__/avatars/<?php echo $va['diagnosis']; ?>.gif" /></a></td>
    <td align="center"><span><?php if($va['type']==0){ echo '预约到诊'; }else{ echo '自然到诊'; }  ?></span></td>
    <td align="center"><a href="#" title="是否消费"><img src="__ADMIN_ACEADMIN__/avatars/<?php echo $va['consumption']; ?>.gif" /></a></td>
    <td align="center"><a href="#'" title="是否住院"><img src="__ADMIN_ACEADMIN__/avatars/<?php echo $va['hospital']; ?>.gif" /></a></td>
    <td align="center"><span><?php if($va['again']==0){ echo '初诊'; }else{ echo '复诊'; }  ?></span></td>
    <td align="center"><span><?php echo date('Y-m-d H:i:s',$va['time']); ?></span></td>
    <td align="center">
      <a href="javascript:void(0);" title="转诊该患者" class="referral" refeid="{$va['id']}" onclick="refer(<?php echo $va['id']; ?>)">
        <img src="__ADMIN_ACEADMIN__/avatars/referral.png" width="80" height="16" border="0"/>
      </a>
    </td>
  </tr>
<?php endforeach ?>
  </table>
<!-- end goods list -->

<!-- 分页 -->
<table id="page-table" cellspacing="0">
  <tr>
    <td align="center" nowrap="true" >
          <!-- $Id: page.htm 14216 2008-03-10 02:27:21Z testyang $ -->
		<div class="pagination">
　　		{$page}
		</div>
    </td>
  </tr>
</table>

</div>
</form>

<div class="login">
<form name="contact" method="post" action=""> 
    <div class="login-title">患者转诊<span><a href="javascript:void(0);" class="close-login">关闭</a></span></div>
    <div class="login-input-content">
        <div class="login-input">
            <label>选择专家：</label>
            <select name="zzzj" style="width:200px;height:30px" id="zzzj">
      <option value="" id="username" name="username" selected="selected">转诊专家</option>
      <foreach name="zhuanj" item="e">
        <option value="{$e['zjname']}" name="username" id="username">{$e['zjname']}</option>
      </foreach>
    </select><br/><br/>
            <!-- <input type="text" placeholder="请输入专家名"  name="info[username]" id="username" class="list-input"/> -->
            <label>预约时间：</label><input class="" readonly="readonly" name="refetime" id="refetime" type="text"> <br/><br/><br/>
            <label>病症描述：</label>
            <input type="text" placeholder="请输入病情描述"  name="dialogue" id="dialogue" class="list-input"/>
        </div>
        <span class="msg" value=""></span>
        <input type="hidden" id="refeid" value="">
        <input type="hidden" id="refename" value="">
    </div>
    <!-- <div class="login-button"><a href="javascript:void(0);" id="button-submit">转诊患者</a></div> -->
    <div style="*position:absolute;_left:44%;text-align:center;">
    <input type="submit" name="submit" class="login-button" id="button-submit" value="转诊患者" /> 
  </div>
</form> 
</div>
</body>

<script type="text/javascript">

        $(function () {

      var currYear = (new Date()).getFullYear();  

      var opt={};

      opt.date = {preset : 'date'};

      opt.datetime = {preset : 'datetime'};

      opt.time = {preset : 'time'};

      opt.default = {

        theme: 'android-ics light', //皮肤样式

            display: 'modal', //显示方式 

            mode: 'scroller', //日期选择模式

        dateFormat: 'yyyy-mm-dd',

        lang: 'zh',

        showNow: true,

        nowText: "今天",

            startYear: currYear, //开始年份

            endYear: currYear + 10 //结束年份

      };



        $("#appDate").mobiscroll($.extend(opt['date'], opt['default']));

        var optDateTime = $.extend(opt['datetime'], opt['default']);

        var optTime = $.extend(opt['time'], opt['default']);

        $("#refetime").mobiscroll(optDateTime).datetime(optDateTime);

        $("#appTime").mobiscroll(optTime).time(optTime);

        });

    </script>

  <script language = "JavaScript" type="text/javascript">
      function refer(id){
         $('#refeid').val(id);
    }
  $(document).ready(function(){

    $(function(){
      //弹窗隐藏
      $('.login').hide();
      //点击弹窗
      $('.referral').click(function(){

        $('.login').show();
        $('.login-bg').show();
      });
      //关闭弹窗
      $('.close-login').click(function(){
            $('.login').hide();
            $('.login-bg').hide();
        });
      //ajax提交转诊患者
      $("#button-submit").on('click',function(){
        var id = $('#refeid').val();
        // console.log(id);
       
          name=$("#zzzj option:selected").val();
                  // text=$("#zzzj option:selected").text();
                  // $("p").text("你选中的是"+text+"值为"+value);

         
        var dialogue = $('#dialogue').val();
        var refetime = $('#refetime').val();
        if(name == ""){
          $('.insert').remove();
          $('.login-button').before("<div style='color:red;' class='insert'>请填写专家名</div>");
          $("#username").focus();
                // name.focus();
                return false;
        }else{
        // console.log(name);
        if(confirm("确认将患者转诊给专家 "+name+" ？")){
          $.ajax({
            url: '/index.php/Admin/Make/Preferral',
            type: 'post',
            dataType: 'json',
            data: {id: id,name:name,dialogue:dialogue,refetime:refetime},
            success:function(response){
              if(response['code'] == 10001){
                $('.insert').remove();
                $('.login-button').before("<div style='color:red;' class='insert'>"+response['msg']+"</div>");
              }else if(response['code'] == 10002){
                $('.insert').remove();
                $('.login-button').before("<div style='color:red;' class='insert'>"+response['msg']+"</div>");
              }else if(response['code'] == 10003){
                $('.insert').remove();
                $('.login-button').before("<div style='color:red;' class='insert'>"+response['msg']+"</div>");
              }
              else if(response['code'] == 10000){
                alert(response['msg']);
                $('.login').hide();
                $('.login-bg').hide();
              }
              else if(response['code'] == 10004){
                $('.insert').remove();
                $('.login-button').before("<div style='color:red;' class='insert'>"+response['msg']+"</div>");
              }
              else if(response['code'] == 10005){
                $('.insert').remove();
                $('.login-button').before("<div style='color:red;' class='insert'>"+response['msg']+"</div>");
              }
              else if(response['code'] == 10006){
                $('.insert').remove();
                $('.login-button').before("<div style='color:red;' class='insert'>"+response['msg']+"</div>");
              }else if(response['code'] == 10007){
                $('.insert').remove();
                $('.login-button').before("<div style='color:red;' class='insert'>"+response['msg']+"</div>");
              }else if(response['code'] == 10008){
                $('.insert').remove();
                $('.login-button').before("<div style='color:red;' class='insert'>"+response['msg']+"</div>");
              }
            }
          });
        }}
        return false;
      });
    });
    });
  </script>
</html>