<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <title>数据检索</title>
    <link href="__ADMIN_ACEADMIN__/css/global.css" rel="stylesheet" type="text/css">
    <link href="__ADMIN_ACEADMIN__/css/data-search.css" rel="stylesheet" type="text/css">
    <script src="__ADMIN_ACEADMIN__/js/jquery-1.8.3.min.js"></script>
    <script src="__ADMIN_ACEADMIN__/js/common.js"></script>
    <script type="text/javascript" src="__ADMIN_ACEADMIN__/js/data-search.js"></script>
    <script type="text/javascript" src="__ADMIN_ACEADMIN__/js/datepicker.js"></script>
    <script language="javascript" type="text/javascript"
     src="__ADMIN_ACEADMIN__/js/My97DatePicker/WdatePicker.js"></script>
    <!--[if lt IE 9]>
    <script src="__ADMIN_ACEADMIN__/js/html5shiv.min.js"></script>
    <![endif]-->
</head>
<style>
    /*.shijian{*/
    /*background-color:#FFFFFF;*/
    /*}*/
    .biao{
            width: 130px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            border: 1px solid #e4e8eb;
    }


    #tiaozhuan{
        display: block;
        height: 30px;
        border: 1px solid #e4e8eb;
        border-radius: 4px;
        background: #f8f9fb;
        cursor: pointer;
    }

    #btn {
        text-align: center;
        margin-right: 254px;
    }

    .data-search #form2 .page ul li .btn2 {
        width: 67px;
        color: rgb(53, 53, 53);
    }

    .searchPopup-con {
        width: 304px;
        height: auto;
        background-color: rgb(255, 255, 255);
        position: absolute;
        top: 30%;
        left: 40%;
        margin-top: -104px;
        margin-left: -191px;
        padding: 20px 38px 0px;
        border-radius: 10px;
        border-width: 1px;
        border-style: solid;
        border-color: rgb(211, 211, 211);
        border-image: initial;
    }

    .searchPopup-con .sPopup-list {
        overflow-y: scroll;
    }

    .sPopup-list {
        height: 350px;
    }

    .container {
        background-color: #f8f9fb;
        padding: 0 0 100px;
    }

    #chongzhi {
        width: 94px;
        height: 30px;
        padding-right: 18px;
        font-size: 12px;
        color: #fff;
        border: none;
        background: #438eb9 60px center no-repeat;
    }
</style>


<body>
<script>
    $(function () {
        table1();
    });


    function formatDateTime(timeStamp) {
        var date = new Date();
        date.setTime(timeStamp * 1000);
        var y = date.getFullYear();
        var m = date.getMonth() + 1;
        m = m < 10 ? ('0' + m) : m;
        var d = date.getDate();
        d = d < 10 ? ('0' + d) : d;
        var h = date.getHours();
        h = h < 10 ? ('0' + h) : h;
        var minute = date.getMinutes();
        var second = date.getSeconds();
        minute = minute < 10 ? ('0' + minute) : minute;
        second = second < 10 ? ('0' + second) : second;
        return y + '-' + m + '-' + d;
    }
    ;


    //弹窗
    function sPopup(num) {

        //模拟数据
//        var data=[['中医肿瘤科','妇科','中医消化科','中老年病','中医神经科','中医呼吸科','中医皮肤科'],['美容1','美容1','美容1','美容1','美容1','美容1'],['美容2','美容2','美容2','美容2','美容2','美容2'],['美容3','美容3','美容3','美容3','美容3','美容3'],['美容4','美容4','美容4','美容4','美容4','美容4'],['美容5','美容5','美容5','美容5','美容5','美容5'],['美容6','美容6','美容6','美容6','美容6','美容6'],['美容7','美容7','美容7','美容7','美容7','美容7'],['美容8','美容8','美容8','美容8','美容8','美容8']];
        var data = eval('{$pic}');
 

        var name = '';
        if (num == 0) {
            name = 'ks';
        } else if (num == 1) {
            name = 'zj';
        } else if (num == 2) {
            name = 'bz';
        } else if (num == 3) {
            name = 'qd';
        } else if (num == 4) {
            name = 'ly';
        } else if (num == 5) {
            name = 'cf';
        } else if (num == 6) {
            name = 'dz';
        } else if (num == 7) {
            name = 'xf';
        } else if (num == 8) {
            name = 'zy';
        }else if (num == 9) {
            name = 'lb';
        }

        var str = '';

        for (var i = 0; i < data[num].length; i++) {
            str += '<li><label><em><i></i></em><input class="quzhi" name="' + name + '" type="checkbox"value="' + data[num][i] + '"/>' + data[num][i] + '</label></li>';
        }


        $('.sPopup-list').html(str);
        $('.searchPopup').fadeIn(200);
        textInputFocus('.searchPopup .searchText .t', '请输入搜索关键字', null, null, null);
        $('.searchText .t').focus();
        searchList();


        $('.searchPopup-con ul input').click(function () {
            // console.log($(this));
            if ($(this).is(':checked')) {
                $(this).parent().find('i').css('display', 'block');
                $(this).attr("checked", "checked");

            } else {
                $(this).parent().find('i').css('display', 'none');
                $(this).removeAttr("checked");
            }
        })

        $('.searchPopup .close').click(function () {
            $('.searchPopup').fadeOut(200, function () {
                $('.sPopup-list').empty();
            });

        })
        $('.searchPopup .close-btn').click(function () {
            $('.searchPopup').fadeOut(200, function () {
                $('.sPopup-list').empty();
            });
        })
    }
    //表格
    function table1() {
        //模拟数据
//        var data=[{
//            id:'1',
//            name:'张真人',
//            tel:18510298818,
//            time:'2019-01-01 11:11:42',
//            come:'✔'
//        },{
//            id:'2',
//            name:'张真人',
//            tel:18510298818,
//            time:'2019-01-01 11:11:42',
//            come:'×'
//        },{
//            id:'3',
//            name:'张真人',
//            tel:18510298818,
//            time:'2019-01-01 11:11:42',
//            come:'✔'
//        }];


        var current_page = $('#current_page').text();
        var tiaosu = $('#status').val();

        var biao = $('#select option:selected') .val();

        var data = eval({$data});

        var str = "";
        var zhen = '';
        for (var i = 0; i < data.length; i++) {
//            console.log(data[i]);
            if (data[i].diagnosis = 0 || data[i].diagnosis == '已到诊') {
                zhen = '✔';
            } else {
                zhen = '×';
            }
            if(data[i].yuyuetime != ''){
                var time = formatDateTime(data[i].yuyuetime);
            }else{
                var time = '暂无预约时间';
            }


            str += '<tr><td><input type="checkbox" name="checkBtn" class="qx"></td><td name="id" >' + data[i].id + '</td><td>' + data[i].name + '</td><td>' + data[i].phone + '</td><td>' + time + '</td><td><em>' + zhen + '</em></td><td><a href="/index.php/Admin/Make/control_edit/id/' + data[i].id + '/biao/'+ biao+'" class="revise"></a> <a href="/index.php/Admin/Analyze/show/id/' + data[i].id + '" class="del"></a></td></tr>';
        }
        $('#table1').append(str);
        $('.data-search table tr:even').addClass('grey');
    }
</script>

<div class="warp">
    <section class="container clearfix">
        <div class="item">
            <div class="content-right" style="margin-left: 0">
                <h2><span>数据检索</span></h2>
                <div class="conBox data-search">
                    <form action="{:U('Admin/Analyze/show')}" name="searchForm" method="post" id="form1">
                        <dl class="yyTime">
                            <dt>预约时间</dt>
                            <dd>
                                <input type="text" name="start" value="{$canshu['start']}"
                                       onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})" id="start"> 至 <input
                                    type="test" id="end" name="end" value="{$canshu['end']}"
                                    onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})">
                                <span><b class="shijian">今天</b> | <b class="shijian">昨天</b> | <b
                                        class="shijian">最近七天</b> | <b class="shijian">本周</b> | <b class="shijian">本月</b></span>
                            </dd>
                        </dl>
                        <dl class="ageRange">
                            <dt>年龄区间</dt>
                            <dd>
                                <input type="text" name="age_start" value="{$canshu['age_start']}" id="age_start"> 到
                                <input type="text" name="age_end" value="{$canshu['age_end']}" id="age_end">
                                <span><b class="nianling">18-24岁</b> | <b class="nianling">25-29岁</b> | <b
                                        class="nianling"> 30-39岁</b> | <b class="nianling">40-49岁</b> | <b
                                        class="nianling">50岁以上</b> <em>(年龄较小的放前面)</em></span>
                            </dd>
                        </dl>
                        <ul>
                            <li>
                                <dl>
                                    <dt>科室</dt>
                                    <dd>
                                        <input type="text" name="yuyueks" value="{$canshu['keshi']}" id="keshi" placeholder="请选择科室" autocomplete="off">
                                    </dd>
                                </dl>
                            </li>
                            <li>
                                <dl>
                                    <dt>专家</dt>
                                    <dd><input type="text" value="{$canshu['zhuanjia']}" name="yuyuezj"
                                               placeholder="请选择专家" id="zhuanjia" autocomplete="off">
                                    </dd>
                                </dl>
                            </li>
                            <li>
                                <dl>
                                    <dt>病种</dt>
                                    <dd><input type="text" value="{$canshu['bz']}" name="yuyuebz" placeholder="请选择病种"
                                               id="bing" autocomplete="off"></dd>
                                </dl>
                            </li>
                            <li>
                                <dl>
                                    <dt>渠道</dt>
                                    <dd><input type="text" name="channel" value="{$canshu['qudao']}" id="qudao"
                                               placeholder="请选择渠道" autocomplete="off"></dd>
                                </dl>
                            </li>
                            <li>
                                <dl>
                                    <dt>来源</dt>
                                    <dd><input type="text" value="{$canshu['source']}" placeholder="请选择来源" name="source"
                                               id="laiyuan" autocomplete="off"></dd>
                                </dl>
                            </li>
                            <li>
                                <dl>
                                    <dt>初复诊</dt>
                                    <dd><input type="text" value="{$canshu['again']}" name="again" placeholder="请选择初复诊"
                                               id="chufu" autocomplete="off"></dd>
                                </dl>
                            </li>
                            <li>
                                <dl>
                                    <dt>到诊情况</dt>
                                    <dd><input type="text" value="{$canshu['diagnosis']}" name="diagnosis"
                                               placeholder="请选择到诊情况" id="daozhen" autocomplete="off">
                                    </dd>
                                </dl>
                            </li>
                            <li>
                                <dl>
                                    <dt>消费情况</dt>
                                    <dd><input type="text" value="{$canshu['consumption']}" name="consumption"
                                               placeholder="请选择消费情况" id="xiaofei" autocomplete="off"></dd>
                                </dl>
                            </li>
                            <li>
                                <dl>
                                    <dt>住院情况</dt>
                                    <dd><input type="text" value="{$canshu['hospital']}" placeholder="请选择住院情况"
                                               name="hospital" id="zhuyuan" autocomplete="off">
                                    </dd>
                                </dl>
                            </li>
                             <li>
                                <dl>
                                    <dt>资源类别</dt>
                                    <dd><input type="text" value="{$canshu['leibie']}" name="leibie" placeholder="请请选择"
                                               name="phone" id="leibie" autocomplete="off">
                                    </dd>
                                </dl>
                            </li>
                              <li>
                                <dl>
                                    <dt>电话</dt>
                                    <dd><input type="text" value="{$canshu['phone']}" placeholder="请输入电话号"
                                               name="phone" id="phone" autocomplete="off">
                                    </dd>
                                </dl>
                            </li>
                               <li>
                                <dl>
                                    <dt>检索表</dt>
                                    <dd>
                                        <select class="biao" name="biao" id="select">
                                          <option value ="1" <if condition="($canshu['biao'] == 1)"> selected</if>> 患者表</option>
                                            <option value ="2" <if condition="($canshu['biao'] == 2)"> selected</if>>电话表</option>
                                        </select>
                                    </dd>
                                </dl>
                            </li>
                        </ul>
                        <dl class="tjTime">
                            <dt>提交时间</dt>
                            <dd>
                                <input type="text" name="start_time" value="{$canshu['start_time']}" id="start_time"
                                       onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})"> 至 <input
                                    type="text" name="end_time" value="{$canshu['end_time']}"
                                    onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})" id="end_time">
                                <span><b class="shijian">今天</b> | <b class="shijian">昨天</b> | <b
                                        class="shijian">最近七天</b> | <b class="shijian">本周</b> | <b class="shijian">本月</b></span>
                            </dd>
                        </dl>
                        <div class="btn" id="btn">
                            <input type="submit" class="search-btn" value="搜索" id="search">
                            <input type="button" class="search-btn" value="重置" id="chongzhi"
                                   style="background: #438eb9;margin-left: 100px;text-align: center;">
                            <!--<input type="reset" value="这个是Form清除" />-->
                        </div>

                        <!--<div class="btn"><input type="button" class="search-btn chongzhi" value="重置"></div>-->
                    </form>
                    <!--<iframe id="is_iframe" name="fraSubmit" style="display:none;"></iframe>-->

                    <form action="" method="post" id="form2" confirmSubmit(this)>
                        <table id="table1">
                            <tr>
                                <th><input type="checkbox" onclick="quanxuan(this)"></th>
                                <th>ID</th>
                                <th>姓名</th>
                                <th>电话</th>
                                <th>预约时间</th>
                                <th>是否到诊</th>
                                <th>操作</th>
                            </tr>
                        </table>
                        <div class="page">
                            <ul>
                                <li>显示行数：</li>
                                <li>
                                    <select id="status" onchange="test()">
                                        <option value="10" <php>if($xianshi== 10){</php>selected<php>}</php> >10</option>
                                        <option value="20" <php>if($xianshi== 20){</php>selected<php>}</php>>20</option>
                                        <option value="30" <php>if($xianshi== 30){</php>selected<php>}</php>>30</option>
                                    </select>
                                </li>
                                <li><span id="current_page">{$current_page}</span>/<span
                                        id="total_page">{$total_page}</span></li>
                                <li><a class="btn1" id="btn1"></a></li>
                                <li><input type="text" id="page_shu" value=""></li>
                                <li><span class="btn2" id="tiaozhuan">跳转</span></li>
                            </ul>
                        </div>


                        <div class="push">
                            <input type="hidden" name="condition" id="condition" value="<?php echo $condition;?>"/>
                            <label>推送活动
                                <select name="activity" id="activity"
                                        style="margin-left:10px;height: 30px;width: 200px;">
                                    <option value="">选择活动内容</option>
                                    <foreach name="activity" item="activity">
                                        <option value="{$activity.id}">{$activity.name}</option>
                                    </foreach>
                                </select>
                            </label>
                            <ul>
                                <label><input type="checkbox" name="pushStyle" value="1">短信推送</label>
                                <label><input type="checkbox" name="pushStyle" value="2">站内推送</label>
                                <label><input type="checkbox" name="pushStyle" value="3">微信推送</label>
                            </ul>
                            <input type="button" value="确定推送" class="submit" id="sendmsg">
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>
</div>

<div class="searchPopup">
    <div class="searchPopup-mask"></div>
    <div class="searchPopup-con">
        <span class="close"></span>
        <form action="" method="post">
            <dl class="searchText">
                <!--<dt><input type="text" class="t" name="" value=""></dt>-->
                <!--<dd><input type="submit" class="subBtn" value=""></dd>-->
                <dd>
                    <ul id="suggestions">


                    </ul>
                </dd>
            </dl>
            <ul class="sPopup-list">
                <!-- <li><label><em><i></i></em><input name="ks" type="checkbox" value="中医肿瘤科"/>中医肿瘤科</label></li>
                <li><label><em><i></i></em><input name="ks" type="checkbox" value="妇科" />妇科</label></li>
                <li><label><em><i></i></em><input name="ks" type="checkbox" value="中医消化科" />中医消化科</label></li>
                <li><label><em><i></i></em><input name="ks" type="checkbox" value="中老年病" />中老年病</label></li>
                <li><label><em><i></i></em><input name="ks" type="checkbox" value="中医神经科" />中医神经科</label></li>
                <li><label><em><i></i></em><input name="ks" type="checkbox" value="中医呼吸科" />中医呼吸科</label></li>
                <li><label><em><i></i></em><input name="ks" type="checkbox" value="中医皮肤科" />中医皮肤科</label></li> -->
            </ul>
            <div class="btns">
                <input type="button" value="确认" class="close-btn" onclick="GetGain()" id="button">
                <input type="button" value="取消" class="close-btn">
            </div>
        </form>
    </div>
</div>
<script>

   
     $(document).on('click', ".qx", function(){
   
        if($("input[type='checkbox']").is(':checked') == false){
            alert(22);
             $(this).attr('checked', false);     
        }else{
             $(this).attr('checked', true);     
        }            
    });


     function dianji(id){

         var id = id;
         var dianqian_page = $('#current_page').text();
         var xianshi_tiao = $("#status  option:selected").text();
         var start = $('#start').val();
         var end = $('#end').val();
         var age_start = $('#age_start').val();
         var age_end = $('#age_end').val();
         var yuyueks = $('#keshi').val();
         var yuyuezj = $('#zhuanjia').val();
         var yuyuebz = $('#bing').val();
         var channel = $('#qudao').val();
         var source = $('#laiyuan').val();
         var again = $('#chufu').val();
         var diagnosis = $('#daozhen').val();
         var consumption = $('#xiaofei').val();
         var hospital = $('#zhuyuan').val();
         var start_time = $('#start_time').val();
         var end_time = $('#end_time').val();

         var total_page = $('#total_page').text();

         if (start == '') {
             start = 0;
         }

         if (end == '') {
             end = 0;
         }


         if (age_start == '') {
             age_start = 0;
         }

         if (age_end == '') {
             age_end = 0;
         }

         if (yuyueks == '') {
             yuyueks = 0;
         }

         if (yuyuezj == '') {
             yuyuezj = 0;
         }
         if (yuyuebz == '') {
             yuyuebz = 0;
         }

         if (channel == '') {
             channel = 0;
         }

         if (source == '') {
             source = 0;
         }

         if (again == '') {
             again = 0;
         }

         if (diagnosis == '') {
             diagnosis = 0;
         }


         if (consumption == '') {
             consumption = 0;
         }

         if (hospital == '') {
             hospital = 0;
         }

         if (start_time == '') {
             start_time = 0;
         }

         if (end_time == '') {
             end_time = 0;
         }

         if (dianqian_page > total_page) {
             alert('已经是最后一页');
             return;
         }

         data = {};
         data.dianqian_page = dianqian_page;
         data.xianshi_tiao = xianshi_tiao;
         data.start = start;
         data.end = end;
         data.age_start = age_start;
         data.age_end = age_end;
         data.yuyueks = yuyueks;
         data.yuyuezj = yuyuezj;
         data.yuyuebz = yuyuebz;
         data.channel = channel;
         data.source = source;
         data.again = again;
         data.diagnosis = diagnosis;
         data.consumption = consumption;
         data.hospital = hospital;
         data.start_time = start_time;
         data.end_time = end_time;
         data.id = id;
 console.log(data)
         $.ajax({
             type: "post",
             dataType: "json",
             url: "{:U('Admin/Analyze/show')}",
             data: data,
             success: function (shuju) {

                 $('#table1 tr:gt(0)').remove();//删除之前的数据


                 var data = eval('(' + shuju + ')'); //转为json对象

                 var str = "";
                 var zhen = '';
                 for (var i = 0; i < data.data.length; i++) {
                     if (data.data[i].diagnosis = 0) {
                         zhen = '✔';
                     } else {
                         zhen = '×';
                     }
                     var time = formatDateTime(data.data[i].yuyuetime);


                     str += '<tr><td><input type="checkbox" name="checkBtn"></td><td td name="id">' + data.data[i].id + '</td><td>' + data.data[i].name + '</td><td>' + data.data[i].phone + '</td><td>' + time + '</td><td><em>' + zhen + '</em></td><td>' +
                             '<a href="/index.php/Admin/Make/control_edit/id/' + data.data[i].id + '/form_page/' + dianqian_page + '/form_tiaoshu/' + xianshi_tiao + '/start/' + start + '/end/' + end + '/age_start/' + age_start + '/age_end/' + age_end + '/yuyueks/' + yuyueks + '/yuyuezj/' + yuyuezj + '/yuyuebz/' + yuyuebz + '/channel/' + channel + '/source/' + source + '/again/' + again + '/diagnosis/' + diagnosis + '/consumption/' + consumption + '/hospital/' + hospital + '/start_time/' + start_time + '/end_time/' + end_time + ' " class="revise"></a>' +
                             '<a href="javascript:;" class="del"  onclick="dianji('+id+') "></a></td></tr>';
                 }
                 $('#table1').append(str);
                 $('.data-search table tr:even').addClass('grey');

                 $('#current_page').html(data.current_page);

                 if (data.total_page == 0) {
                     data.total_page = 1;
                 }

                 $('#total_page').html(data.total_page);

             }
         });
     }





    function quanxuan(a) {
        //找到下面所有的复选框
        var ck = document.getElementsByClassName("qx");
        console.log(ck.length);
        //遍历所有复选框，设置选中状态。
        for (var i = 0; i < ck.length; i++) {
            if (a.checked)//判断全选按钮的状态是不是选中的
            {
                ck[i].setAttribute("checked", "checked");//如果是选中的，就让所有的状态为选中。
            }
            else {
                ck[i].removeAttribute("checked");//如果不是选中的，就移除所有的状态是checked的选项。
            }
        }
    }

    //重置信息
    $('#chongzhi').click(function () {
        $('#start').val('');
        $('#end').val('');
        $('#age_start').val('');
        $('#age_end').val('');
        $('#keshi').val('');
        $('#zhuanjia').val('');
        $('#bing').val('');
        $('#qudao').val('');
        $('#laiyuan').val('');
        $('#chufu').val('');
        $('#daozhen').val('');
        $('#xiaofei').val('');
        $('#zhuyuan').val('');
        $('#start_time').val('');
        $('#end_time').val('');
        $('#phone').val('');
        $('#leibie').val('');

    });


    $('.shijian').click(function () {
        setTimeout(function () {
            $('#form1').submit();
        }, 1000)
    });

    $('.nianling').click(function () {
        setTimeout(function () {
            $('#form1').submit();
        }, 1000)
    });


    function test() {

        var page = $('#status').val();
        var start = $('#start').val();
        var end = $('#end').val();
        var age_start = $('#age_start').val();
        var age_end = $('#age_end').val();
        var yuyueks = $('#keshi').val();
        var yuyuezj = $('#zhuanjia').val();
        var yuyuebz = $('#bing').val();
        var channel = $('#qudao').val();
        var source = $('#laiyuan').val();
        var again = $('#chufu').val();
        var diagnosis = $('#daozhen').val();
        var consumption = $('#xiaofei').val();
        var hospital = $('#zhuyuan').val();
        var start_time = $('#start_time').val();
        var end_time = $('#end_time').val();
        var current_page = $('#current_page').text();
        var leibie = $('#leibie').val();
        var phone = $('#phone').val();
        var biao = $('#select option:selected') .val();

        var data = {};
        data.page = page;
        data.current_page = current_page;
        data.start = start;
        data.end = end;
        data.age_start = age_start;
        data.age_end = age_end;
        data.yuyueks = yuyueks;
        data.yuyuezj = yuyuezj;
        data.yuyuebz = yuyuebz;
        data.channel = channel;
        data.source = source;
        data.again = again;
        data.diagnosis = diagnosis;
        data.consumption = consumption;
        data.hospital = hospital;
        data.start_time = start_time;
        data.end_time = end_time;
        data.phone = phone;
        data.leibie = leibie;
        data.biao = biao;

        if (start == '') {
            start = 0;
        }

        if (end == '') {
            end = 0;
        }


        if (age_start == '') {
            age_start = 0;
        }

        if (age_end == '') {
            age_end = 0;
        }

        if (yuyueks == '') {
            yuyueks = 0;
        }

        if (yuyuezj == '') {
            yuyuezj = 0;
        }
        if (yuyuebz == '') {
            yuyuebz = 0;
        }

        if (channel == '') {
            channel = 0;
        }

        if (source == '') {
            source = 0;
        }

        if (again == '') {
            again = 0;
        }

        if (diagnosis == '') {
            diagnosis = 0;
        }


        if (consumption == '') {
            consumption = 0;
        }

        if (hospital == '') {
            hospital = 0;
        }

        if (start_time == '') {
            start_time = 0;
        }

        if (end_time == '') {
            end_time = 0;
        } 

        $.ajax({
            type: "post",
            dataType: "json",
            url: "{:U('Admin/Analyze/show')}",
            data: data,
            success: function (shuju) {

                $('#table1 tr:gt(0)').remove();//删除之前的数据


                var data = eval('(' + shuju + ')'); //转为json对象
                console.log(data);
                var str = "";
                var zhen = '';
                for (var i = 0; i < data.data.length; i++) {
                    if (data.data[i].diagnosis = 0) {
                        zhen = '✔';
                    } else {
                        zhen = '×';
                    }
                    var time = formatDateTime(data.data[i].yuyuetime);

                    var id = data.data[i].id;

                    str += '<tr><td><input type="checkbox" name="checkBtn"></td><td td name="id">' + data.data[i].id + '</td><td>' + data.data[i].name + '</td><td>' + data.data[i].phone + '</td><td>' + time + '</td><td><em>' + zhen + '</em></td><td>' +
                            '<a href="/index.php/Admin/Make/control_edit/id/' + data.data[i].id + '/form_page/' + data.current_page + '/form_tiaoshu/' + page + '/start/' + start + '/end/' + end + '/age_start/' + age_start + '/age_end/' + age_end + '/yuyueks/' + yuyueks + '/yuyuezj/' + yuyuezj + '/yuyuebz/' + yuyuebz + '/channel/' + channel + '/source/' + source + '/again/' + again + '/diagnosis/' + diagnosis + '/consumption/' + consumption + '/hospital/' + hospital + '/start_time/' + start_time + '/end_time/' + end_time + ' " class="revise"></a>' +
                            '<a href="javascript:;" class="del"  onclick="dianji('+id+') "></a></td></tr>';
                }

                $('#table1').append(str);
                $('.data-search table tr:even').addClass('grey');

                $('#current_page').html(data.current_page);


                if (data.total_page == 0) {
                    data.total_page = 1;
                }

                $('#total_page').html(data.total_page);

            }
        });
    }


    $('#btn1').click(function () {
        var dianqian_page = $('#current_page').text();
        var xianshi_tiao = $("#status  option:selected").text();
        var start = $('#start').val();
        var end = $('#end').val();
        var age_start = $('#age_start').val();
        var age_end = $('#age_end').val();
        var yuyueks = $('#keshi').val();
        var yuyuezj = $('#zhuanjia').val();
        var yuyuebz = $('#bing').val();
        var channel = $('#qudao').val();
        var source = $('#laiyuan').val();
        var again = $('#chufu').val();
        var diagnosis = $('#daozhen').val();
        var consumption = $('#xiaofei').val();
        var hospital = $('#zhuyuan').val();
        var start_time = $('#start_time').val();
        var end_time = $('#end_time').val();
        var total_page = $('#total_page').text();
        var leibie = $('#leibie').val();
        var phone = $('#phone').val();
        var biao = $('#select option:selected') .val();

        dianqian_page++;

        if (start == '') {
            start = 0;
        }

        if (end == '') {
            end = 0;
        }


        if (age_start == '') {
            age_start = 0;
        }

        if (age_end == '') {
            age_end = 0;
        }

        if (yuyueks == '') {
            yuyueks = 0;
        }

        if (yuyuezj == '') {
            yuyuezj = 0;
        }
        if (yuyuebz == '') {
            yuyuebz = 0;
        }

        if (channel == '') {
            channel = 0;
        }

        if (source == '') {
            source = 0;
        }

        if (again == '') {
            again = 0;
        }

        if (diagnosis == '') {
            diagnosis = 0;
        }


        if (consumption == '') {
            consumption = 0;
        }

        if (hospital == '') {
            hospital = 0;
        }

        if (start_time == '') {
            start_time = 0;
        }

        if (end_time == '') {
            end_time = 0;
        }

        if (dianqian_page > total_page) {
            alert('已经是最后一页');
            return;
        }

        data = {};
        data.dianqian_page = dianqian_page;
        data.xianshi_tiao = xianshi_tiao;
        data.start = start;
        data.end = end;
        data.age_start = age_start;
        data.age_end = age_end;
        data.yuyueks = yuyueks;
        data.yuyuezj = yuyuezj;
        data.yuyuebz = yuyuebz;
        data.channel = channel;
        data.source = source;
        data.again = again;
        data.diagnosis = diagnosis;
        data.consumption = consumption;
        data.hospital = hospital;
        data.start_time = start_time;
        data.end_time = end_time;
        data.phone = phone;
        data.leibie = leibie;
        data.biao = biao;

        $.ajax({
            type: "post",
            dataType: "json",
            url: "{:U('Admin/Analyze/show')}",
            data: data,
            success: function (shuju) {

                $('#table1 tr:gt(0)').remove();//删除之前的数据


                var data = eval('(' + shuju + ')'); //转为json对象
                console.log(data);
                var str = "";
                var zhen = '';
                for (var i = 0; i < data.data.length; i++) {
                    if (data.data[i].diagnosis = 0) {
                        zhen = '✔';
                    } else {
                        zhen = '×';
                    }
                    var time = formatDateTime(data.data[i].yuyuetime);


                    str += '<tr><td><input type="checkbox" name="checkBtn"></td><td td name="id">' + data.data[i].id + '</td><td>' + data.data[i].name + '</td><td>' + data.data[i].phone + '</td><td>' + time + '</td><td><em>' + zhen + '</em></td><td>' +
                            '<a href="/index.php/Admin/Make/control_edit/id/' + data.data[i].id + '/form_page/' + dianqian_page + '/form_tiaoshu/' + xianshi_tiao + '/start/' + start + '/end/' + end + '/age_start/' + age_start + '/age_end/' + age_end + '/yuyueks/' + yuyueks + '/yuyuezj/' + yuyuezj + '/yuyuebz/' + yuyuebz + '/channel/' + channel + '/source/' + source + '/again/' + again + '/diagnosis/' + diagnosis + '/consumption/' + consumption + '/hospital/' + hospital + '/start_time/' + start_time + '/end_time/' + end_time + '/biao/'+ biao+' " class="revise"></a><a href="/index.php/Admin/Analyze/show/id/' + data.data[i].id  + '" class="del"></td></tr>';
                }
                $('#table1').append(str);
                $('.data-search table tr:even').addClass('grey');

                $('#current_page').html(data.current_page);

                if (data.total_page == 0) {
                    data.total_page = 1;
                }

                $('#total_page').html(data.total_page);

            }
        });


    });


    $('#tiaozhuan').click(function () {
//        alert(11111);
        var xianshi = $("#status  option:selected").text();
        var page_shu = $('#page_shu').val();
        var start = $('#start').val();
        var end = $('#end').val();
        var age_start = $('#age_start').val();
        var age_end = $('#age_end').val();
        var yuyueks = $('#keshi').val();
        var yuyuezj = $('#zhuanjia').val();
        var yuyuebz = $('#bing').val();
        var channel = $('#qudao').val();
        var source = $('#laiyuan').val();
        var again = $('#chufu').val();
        var diagnosis = $('#daozhen').val();
        var consumption = $('#xiaofei').val();
        var hospital = $('#zhuyuan').val();
        var start_time = $('#start_time').val();
        var end_time = $('#end_time').val();
        var total_page = $('#total_page').text();
        var leibie = $('#leibie').val();
        var phone = $('#phone').val();
        var biao = $('#select option:selected') .val();

        if (start == '') {
            start = 0;
        }

        if (end == '') {
            end = 0;
        }


        if (age_start == '') {
            age_start = 0;
        }

        if (age_end == '') {
            age_end = 0;
        }

        if (yuyueks == '') {
            yuyueks = 0;
        }

        if (yuyuezj == '') {
            yuyuezj = 0;
        }
        if (yuyuebz == '') {
            yuyuebz = 0;
        }

        if (channel == '') {
            channel = 0;
        }

        if (source == '') {
            source = 0;
        }

        if (again == '') {
            again = 0;
        }

        if (diagnosis == '') {
            diagnosis = 0;
        }


        if (consumption == '') {
            consumption = 0;
        }

        if (hospital == '') {
            hospital = 0;
        }

        if (start_time == '') {
            start_time = 0;
        }

        if (end_time == '') {
            end_time = 0;
        }

        data = {};
        data.page_shu = page_shu;
        data.xianshi = xianshi;
        data.start = start;
        data.end = end;
        data.age_start = age_start;
        data.age_end = age_end;
        data.yuyueks = yuyueks;
        data.yuyuezj = yuyuezj;
        data.yuyuebz = yuyuebz;
        data.channel = channel;
        data.source = source;
        data.again = again;
        data.diagnosis = diagnosis;
        data.consumption = consumption;
        data.hospital = hospital;
        data.start_time = start_time;
        data.end_time = end_time;
        data.leibie = leibie;
        data.phone = phone;
        data.biao = biao;

        $.ajax({
            type: "post",
            dataType: "json",
            url: "{:U('Admin/Analyze/show')}",
            data: data,
            success: function (msg) {
//                console.log(msg);
                $('#table1 tr:gt(0)').remove();//删除之前的数据

                var data = eval('(' + msg + ')'); //转为json对象

                var str = "";
                var zhen = '';
                for (var i = 0; i < data.data.length; i++) {
                    if (data.data[i].diagnosis = 0) {
                        zhen = '✔';
                    } else {
                        zhen = '×';
                    }
                    var time = formatDateTime(data.data[i].yuyuetime);


                    str += '<tr><td><input type="checkbox" name="checkBtn"></td><td td name="id">' + data.data[i].id + '</td><td>' + data.data[i].name + '</td><td>' + data.data[i].phone + '</td><td>' + time + '</td><td><em>' + zhen + '</em></td><td>' +
                            '<a href="/index.php/Admin/Make/control_edit/id/' + data.data[i].id + '/form_page/' + page_shu + '/form_tiaoshu/' + xianshi + '/start/' + start + '/end/' + end + '/age_start/' + age_start + '/age_end/' + age_end + '/yuyueks/' + yuyueks + '/yuyuezj/' + yuyuezj + '/yuyuebz/' + yuyuebz + '/channel/' + channel + '/source/' + source + '/again/' + again + '/diagnosis/' + diagnosis + '/consumption/' + consumption + '/hospital/' + hospital + '/start_time/' + start_time + '/end_time/' + end_time +'/biao/'+ biao+' " class="revise"></a><a href="/index.php/Admin/Analyze/show/id/' + data.data[i].id  + '" class="del"></a></td></tr>';
                }
                $('#table1').append(str);
                $('.data-search table tr:even').addClass('grey');

                $('#current_page').html(data.current_page);

                if (data.total_page == 0) {
                    data.total_page = 1;
                }
                $('#total_page').html(data.total_page);

            }
        });


//        var url = "{:U('Admin/Analyze/show')}?page_shu=" + page_shu + "xianshi = " + xianshi;
//
//        $(this).attr("href", url);  //改变当前a的href值
    });


    function GetGain() {

        var yuyueks = new Array();
        var yuyuezj = new Array();
        var yuyuebz = new Array();
        var channel = new Array();
        var source = new Array();
        var again = new Array();
        var diagnosis = new Array();
        var consumption = new Array();
        var hospital = new Array();
        var leibie = new Array();


        $(".quzhi").each(function () {
            var name = $(this).attr("name");

            if (name == 'ks') {
                $("input[type=checkbox][checked]").each(function () { //由于复选框一般选中的是多个,所以可以循环输出
                    console.log($(this).val());
                    yuyueks.push($(this).val());
                });
                yuyueks = uniq(yuyueks);
//                console.log(yuyueks);
                document.getElementById('keshi').value = yuyueks;
            } else if (name == 'zj') {
                $("input[type=checkbox][checked]").each(function () { //由于复选框一般选中的是多个,所以可以循环输出
                    yuyuezj.push($(this).val());
                });
                yuyuezj = uniq(yuyuezj);
                document.getElementById('zhuanjia').value = yuyuezj;
            } else if (name == 'bz') {
                $("input[type=checkbox][checked]").each(function () { //由于复选框一般选中的是多个,所以可以循环输出
                    yuyuebz.push($(this).val());
                    yuyuebz = uniq(yuyuebz);
                    document.getElementById('bing').value = yuyuebz;
                });
            } else if (name == 'qd') {
                $("input[type=checkbox][checked]").each(function () { //由于复选框一般选中的是多个,所以可以循环输出
                    channel.push($(this).val());
                    channel = uniq(channel);
                    document.getElementById('qudao').value = channel;
                });
            } else if (name == 'ly') {
                $("input[type=checkbox][checked]").each(function () { //由于复选框一般选中的是多个,所以可以循环输出
                    source.push($(this).val());
                    source = uniq(source);
                    document.getElementById('laiyuan').value = source;
                });
            } else if (name == 'cf') {
                $("input[type=checkbox][checked]").each(function () { //由于复选框一般选中的是多个,所以可以循环输出
                    again.push($(this).val());
                    again = uniq(again);
                    document.getElementById('chufu').value = again;
                });
            } else if (name == 'dz') {
                $("input[type=checkbox][checked]").each(function () { //由于复选框一般选中的是多个,所以可以循环输出
                    diagnosis.push($(this).val());
                    diagnosis = uniq(diagnosis);
                    document.getElementById('daozhen').value = diagnosis;
                });
            } else if (name == 'xf') {
                $("input[type=checkbox][checked]").each(function () { //由于复选框一般选中的是多个,所以可以循环输出
                    consumption.push($(this).val());
                    consumption = uniq(consumption);
                    document.getElementById('xiaofei').value = consumption;
                });
            } else if (name == 'zy') {
                $("input[type=checkbox][checked]").each(function () { //由于复选框一般选中的是多个,所以可以循环输出
                    hospital.push($(this).val());
                    hospital = uniq(hospital);
                    document.getElementById('zhuyuan').value = hospital;
                });
            }else if (name == 'lb') {
                $("input[type=checkbox][checked]").each(function () { //由于复选框一般选中的是多个,所以可以循环输出
                    leibie.push($(this).val());
                    leibie = uniq(leibie);
                    console.log(leibie);
                    document.getElementById('leibie').value = leibie;
                });
            }


        });
    }

    function uniq(array) {

        var temp = []; //一个新的临时数组
        for (var i = 0; i < array.length; i++) {
            if (temp.indexOf(array[i]) == -1) {
                temp.push(array[i]);
            }
        }
        return temp;
    }

    //    $('#sendmsg').click(function(){
    //        alert($('input[name="pushStyle"]:checked').val());
    //    });


    $('#sendmsg').click(function () {

        var send_way = [];
        var id = [];
        var check=$("input[name='checkBtn']:checked");//选中的复选框
        console.log(check.length);
        check.each(function(){
            var row=$(this).parent("td").parent("tr");
            var name=row.find("[name='id']").html();//注意html()和val()
            id.push(name);
        });

        //取到取那个表中查找对应的信息
        var biao = $('#select option:selected') .val();

        //推送方式
        $("input[type='checkbox']:checked").each(function () {
            send_way.push($(this).val()); //当前被选中checkbox背后对应的值
        });


        $.ajax({
            type: "POST",
            url: "{:U('Admin/Analyze/sendMessage')}",
            data: {activity: $("#activity").val(), send_way: send_way, condition: $("#condition").val(),id:id,biao:biao},
            dataType: "json",
            beforeSend: function (XMLHttpRequest) {
                //此处可添加等待状态
            },
            success: function (data) {
                if (data.code == 100) {
                    $('#successson').html('');
                    $('#failson').html('');
                    $('#success').css("display", "none");
                    $('#fail').css("display", "none");
                    $('#success').css("display", "block");
                    $('#successson').html(data.msg);
                    alert('推送成功');
                }
                else if (data.code == 200) {
                    $('#successson').html('');
                    $('#failson').html('');
                    $('#success').css("display", "none");
                    $('#fail').css("display", "none");
                    $('#fail').css("display", "block");
                    $('#failson').html(data.msg);
                    alert('推送失败');

                }
            }
        });
    });
</script>